{
  "phase": 2,
  "sprint": 1,
  "todoFile": 1,
  "title": "Tesseract.js Setup & Configuration",
  "priority": "HIGH",
  "effort": "6 hours",
  "status": "pending",
  "milestone": "OCR Technical Foundation",
  "tasks": [
    {
      "id": "2.1.1",
      "category": "setup",
      "title": "Install Tesseract.js Package",
      "description": "Install tesseract.js and configure it for use with Web Workers in the Vite/React environment.",
      "status": "pending",
      "estimatedHours": 1,
      "agent": "haiku",
      "files": ["package.json"],
      "testCategories": ["unit"],
      "stepByStep": [
        {
          "step": 1,
          "action": "Install tesseract.js",
          "details": "npm install tesseract.js"
        },
        {
          "step": 2,
          "action": "Verify installation",
          "details": "Check package.json for tesseract.js entry"
        },
        {
          "step": 3,
          "action": "Test import",
          "details": "Create a simple test file to verify import works: import Tesseract from 'tesseract.js'"
        }
      ],
      "acceptanceCriteria": [
        "tesseract.js is installed in package.json",
        "Import statement works without errors",
        "TypeScript types are available"
      ]
    },
    {
      "id": "2.1.2",
      "category": "setup",
      "title": "Create OCR Library Directory Structure",
      "description": "Set up the lib/ocr/ directory with all necessary files for the OCR module.",
      "status": "pending",
      "estimatedHours": 0.5,
      "agent": "haiku",
      "files": [
        "src/lib/ocr/ocrEngine.ts",
        "src/lib/ocr/languageLoader.ts",
        "src/lib/ocr/imagePreprocessor.ts",
        "src/lib/ocr/types.ts",
        "src/lib/ocr/index.ts"
      ],
      "testCategories": ["typecheck"],
      "stepByStep": [
        {
          "step": 1,
          "action": "Create lib/ocr directory",
          "details": "mkdir -p src/lib/ocr"
        },
        {
          "step": 2,
          "action": "Create types.ts with OCR type definitions",
          "details": "Define OCRResult, OCRWord, OCRLine, OCRBlock, BoundingBox interfaces"
        },
        {
          "step": 3,
          "action": "Create empty module files",
          "details": "Create ocrEngine.ts, languageLoader.ts, imagePreprocessor.ts with basic exports"
        },
        {
          "step": 4,
          "action": "Create index.ts barrel export",
          "details": "Export all modules from index.ts"
        }
      ],
      "acceptanceCriteria": [
        "Directory structure created",
        "All files have TypeScript exports",
        "Types compile without errors",
        "Index barrel export works"
      ]
    },
    {
      "id": "2.1.3",
      "category": "types",
      "title": "Define OCR Type Definitions",
      "description": "Create comprehensive TypeScript interfaces for OCR results, configuration, and processing.",
      "status": "pending",
      "estimatedHours": 1.5,
      "agent": "haiku",
      "files": ["src/lib/ocr/types.ts"],
      "testCategories": ["typecheck"],
      "stepByStep": [
        {
          "step": 1,
          "action": "Define BoundingBox interface",
          "code": "export interface BoundingBox {\n  x0: number;\n  y0: number;\n  x1: number;\n  y1: number;\n  width: number;\n  height: number;\n}"
        },
        {
          "step": 2,
          "action": "Define OCRWord interface",
          "code": "export interface OCRWord {\n  text: string;\n  confidence: number;\n  bbox: BoundingBox;\n  baseline: { x0: number; y0: number; x1: number; y1: number };\n  fontSize: number;\n  fontName: string;\n}"
        },
        {
          "step": 3,
          "action": "Define OCRLine interface",
          "code": "export interface OCRLine {\n  text: string;\n  confidence: number;\n  bbox: BoundingBox;\n  words: OCRWord[];\n}"
        },
        {
          "step": 4,
          "action": "Define OCRBlock interface",
          "code": "export interface OCRBlock {\n  text: string;\n  confidence: number;\n  bbox: BoundingBox;\n  lines: OCRLine[];\n  blockType: 'text' | 'table' | 'image';\n}"
        },
        {
          "step": 5,
          "action": "Define OCRResult interface",
          "code": "export interface OCRResult {\n  text: string;\n  confidence: number;\n  blocks: OCRBlock[];\n  lines: OCRLine[];\n  words: OCRWord[];\n  processingTime: number;\n  language: string;\n  pageIndex: number;\n}"
        },
        {
          "step": 6,
          "action": "Define OCROptions interface",
          "code": "export interface OCROptions {\n  language: string;\n  pageSegmentationMode?: number;\n  ocrEngineMode?: number;\n  preserve_interword_spaces?: boolean;\n  tessedit_char_whitelist?: string;\n  tessedit_char_blacklist?: string;\n}"
        },
        {
          "step": 7,
          "action": "Define OCRProgress interface",
          "code": "export interface OCRProgress {\n  status: 'loading' | 'initializing' | 'recognizing' | 'complete' | 'error';\n  progress: number;\n  workerId?: string;\n}"
        }
      ],
      "acceptanceCriteria": [
        "All interfaces defined with JSDoc comments",
        "Types match Tesseract.js output structure",
        "TypeScript compilation passes",
        "Interfaces are exported from index.ts"
      ]
    },
    {
      "id": "2.1.4",
      "category": "implementation",
      "title": "Configure Web Worker for OCR Processing",
      "description": "Set up Tesseract.js to use Web Workers to prevent UI blocking during OCR operations.",
      "status": "pending",
      "estimatedHours": 2,
      "agent": "sonnet",
      "files": ["src/lib/ocr/ocrEngine.ts", "vite.config.ts"],
      "testCategories": ["unit", "integration"],
      "stepByStep": [
        {
          "step": 1,
          "action": "Configure Vite for Web Workers",
          "details": "Ensure Vite handles Tesseract.js worker correctly - may need to configure worker options"
        },
        {
          "step": 2,
          "action": "Create OCREngine class skeleton",
          "code": "import { createWorker, Worker } from 'tesseract.js';\nimport type { OCRResult, OCROptions, OCRProgress } from './types';\n\nexport class OCREngine {\n  private worker: Worker | null = null;\n  private currentLanguage: string = 'eng';\n  private isInitialized: boolean = false;\n  private onProgress?: (progress: OCRProgress) => void;\n\n  constructor(onProgress?: (progress: OCRProgress) => void) {\n    this.onProgress = onProgress;\n  }\n}"
        },
        {
          "step": 3,
          "action": "Implement initialize method",
          "code": "async initialize(language: string = 'eng'): Promise<void> {\n  if (this.worker) {\n    await this.terminate();\n  }\n  \n  this.worker = await createWorker(language, 1, {\n    logger: (m) => {\n      if (this.onProgress) {\n        this.onProgress({\n          status: m.status as OCRProgress['status'],\n          progress: m.progress,\n          workerId: m.workerId\n        });\n      }\n    }\n  });\n  \n  this.currentLanguage = language;\n  this.isInitialized = true;\n}"
        },
        {
          "step": 4,
          "action": "Implement recognize method",
          "code": "async recognize(\n  image: HTMLCanvasElement | ImageData | Blob | string,\n  options?: Partial<OCROptions>\n): Promise<OCRResult> {\n  if (!this.worker || !this.isInitialized) {\n    throw new Error('OCR engine not initialized. Call initialize() first.');\n  }\n  \n  const startTime = performance.now();\n  \n  if (options) {\n    await this.worker.setParameters(options);\n  }\n  \n  const result = await this.worker.recognize(image);\n  const processingTime = performance.now() - startTime;\n  \n  return this.transformResult(result.data, processingTime);\n}"
        },
        {
          "step": 5,
          "action": "Implement terminate method",
          "code": "async terminate(): Promise<void> {\n  if (this.worker) {\n    await this.worker.terminate();\n    this.worker = null;\n    this.isInitialized = false;\n  }\n}"
        },
        {
          "step": 6,
          "action": "Implement result transformation",
          "details": "Create private transformResult method to convert Tesseract output to our OCRResult format"
        }
      ],
      "acceptanceCriteria": [
        "OCREngine class initializes without blocking UI",
        "Worker terminates cleanly",
        "Progress callbacks fire during processing",
        "recognize() returns properly typed OCRResult",
        "Multiple sequential recognize calls work"
      ]
    }
  ],
  "successCriteria": [
    "Tesseract.js installed and configured",
    "OCR types fully defined",
    "OCREngine class functional with Web Worker",
    "Progress reporting works",
    "No UI blocking during OCR"
  ],
  "filesCreated": [
    "src/lib/ocr/types.ts",
    "src/lib/ocr/ocrEngine.ts",
    "src/lib/ocr/index.ts"
  ],
  "filesModified": [
    "package.json",
    "vite.config.ts"
  ],
  "totalNewTests": 8,
  "totalEstimatedHours": 6,
  "dependencies": [],
  "notes": [
    "Tesseract.js v5 recommended for better TypeScript support",
    "Worker configuration may need Vite-specific settings",
    "Language data files are large (~10-15MB each) - implement lazy loading"
  ]
}
